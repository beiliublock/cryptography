### 分组密码模式

##### 1.分组密码与流密码
   + 密码算法可以分为`分组密码`和`流密码`两种
   + `分组密码(compose cipher)`：是每次只能处理特定长度的一块数据的一类密码算法，这里的"一块"就称为`分组(compose)`。
     此外，`一个分组的比特数就成为"分组长度"(compose length)`
       1. DES和三重DES的分组长度都是64bit，也就是说一次可以加密64bit的明文
       2. AES的分组长度为128bit，因此AES可以一次加密128bit的明文
   + `流密码(stream cipher)`：是对数据进行连续处理的一类密码算法。流密码一般以1bit,8bit或32bit等为单位进行加密和解密
   + 区别：分组密码不需要通过内部状态来记录加密的进度，而流密码需要

##### 2.什么是模式
   + 由于分组密码每次只能加密固定的长度，而我们要加密的明文通常都超过分组长度，所以需要通过迭代来进行加密，而这种迭代
   的方式就称为分组密码的模式
   + 分组密码的主要5种模式：
     1. ECB模式：Electronic CodeBook mode [电子密码本模式]
     2. CBC模式：Cipher Block Chaining mode [密码分组链接模式]
     3. CFB模式：Cipher FeedBack mode [密文反馈模式]
     4. OFB模式：Output FeedBack mode [输出反馈模式]
     5. CTR模式：CounTeR mode [计数器模式]
   + 明文分组与密文分组
     + `明文分组`：是指分组密码算法中作为加密对象的明文；明文分组的长度与分组密码算法的分组长度是相等的
     + `密文分组`：是指使用分组密码算法将明文分组加密之后所生成的密文

##### 3.ECB模式(电子密码本模式)
   + 将明文分组直接加密的方式就是ECB模式，但由于这种模式非常简单，因此通常不会被使用
   + 对ECB模式的攻击：由于ECB模式中每个明文分组都可以进行独立的加密和解密，所以就算攻击者不知道
   密钥，只要通过改变密文分组的顺序，就可以改变明文分组，也就是说**攻击者无需破译密钥就能操纵明文**

   ![](https://ww1.sinaimg.cn/large/007iUjdily1fy7jvsjjmwj30ic0iiae0.jpg)

##### 4.CBC模式(密码分组链接模式)
   + CBC模式是将前一个密文分组与当前明文分组的内容混合起来进行加密的，这样就可以避免ECB模式的弱点
   + **在CBC模式中，首先将明文分组与前一个密文分组进行异或运算，然后再进行加密**
   + 初始化向量(IV)，当加密第一个明文分组时，由于不存在"前一个密文分组"，因此需要事先准备一个长度为
   分组长度的比特序列来代替"前一个密文分组"，这个比特序列称为初始化向量(Initialization Vector)，通常
   缩写为IV。一般来说，每次加密时都会随机产生一个不同的比特序列来作为初始化向量
   + 填充提示攻击：在分组密码中，当明文长度不为分组长度的整数倍时，需要在最后一个分组中填充一些数据使其凑满
   一个分组长度，例如2014年对SSL3.0造成重大影响的POODLE攻击；通过不同的填充看服务器返回的错误信息，通过这一信息
   可以获取部分与明文相关的信息
   + 对初始化向量(IV)进行攻击：(IV)必须使用不可预测的随机数，所以在TLS1.1以上的版本中改为必须显示的传送IV(RFC5246 6.2.3.2)

   ![](https://ww1.sinaimg.cn/large/007iUjdily1fy7jwpy1tej30jf0hsjvv.jpg)

##### 5.CFB模式(密文反馈模式)
   + CFB模式：前一个密文分组会被送回到密码算法的输入端，所谓反馈指的是返回输入端的意思，也就是密钥用于加密密文分组
   + CFB模式中由密码算法所生成的比特序列称为**密钥流**，密码算法就相当于用来生成密钥流的伪随机数生成器
   + 对CFB模式的攻击：重放攻击

   ![](https://ww1.sinaimg.cn/large/007iUjdily1fy7ut3vevtj30ix0fsdju.jpg)


##### 6.OFB模式(输出反馈模式)
   + OFB模式：密码算法的输出反馈到下一个密码算法的输出当中
   + 优势：加密必须从第一个明文分组开始按照顺序来，同时，由于加密算法中与明文和密文没有
   任何关系，所以可以提前准备好密钥流与明文进行异或操作，提高效率

   ![](https://ww1.sinaimg.cn/large/007iUjdily1fy7v0atb32j30gc0ldadf.jpg)

##### 7.CTR模式(计数器模式)
   + CTR模式：一种通过将逐次累加的计数器进行加密来生成密钥流的流密码

   ![](https://ww1.sinaimg.cn/large/007iUjdily1fy7v5678b1j30fh0lzae3.jpg)

##### 8. 分组密码模式的比较
   ![](https://ww1.sinaimg.cn/large/007iUjdily1fy7v61drflj30ky0ht0zd.jpg)